# Task 2  

### Цель задания
Реализовать префиксную сумму (scan):
- последовательным способом на CPU;
- на GPU с использованием CUDA и shared memory.

Размер массива: 1000000 элементов.  
Необходимо сравнить корректность результата и время выполнения.


## Используемая среда
- Google Colab (GPU включён)
- GPU: Tesla T4 (compute capability 7.5)
- Язык: C++ / CUDA
- Компилятор: `nvcc`


## Описание CPU-реализации

### Логика работы
1. Создаётся массив размером N.
2. Массив заполняется значением `1` (для простой проверки результата).
3. Один поток CPU проходит по массиву и накапливает сумму:
   - `run = run + in[i]`
   - `out[i] = run`
4. Измеряется время выполнения CPU-scan.


## Описание GPU-реализации 

### Общая идея
GPU-scan реализован в два CUDA-kernel этапа и один простой этап на CPU:
1) scan внутри каждого блока в shared memory  
2) вычисление смещений (offset) для блоков на CPU  
3) добавление offset к каждому элементу блока на GPU  

Это сделано для простоты и корректности при большом N, так как один блок не может обработать сразу весь массив.


### Этап 1 — scan внутри блоков (shared memory)
CUDA-kernel `scan_blocks_kernel`:
1. Каждый блок загружает свою часть массива в shared memory.
2. Внутри блока выполняется префиксная сумма (scan) по шагам `offset = 1, 2, 4, ...`.
3. Результат scan записывается в глобальную память `out`.
4. Последний элемент блока сохраняется в массив `block_sums` как сумма блока.

### Этап 2 — offsets для блоков (CPU)
1. `block_sums` копируется с GPU на CPU.
2. На CPU считается префиксная сумма по `block_sums`.
3. Получается массив `block_offsets`, который хранит сумму всех предыдущих блоков.
4. `block_offsets` копируется обратно на GPU.

### Этап 3 — добавление offsets (GPU)
CUDA-kernel `add_offsets_kernel`:
1. Для каждого элемента массива определяется offset его блока.
2. К значению `out[i]` прибавляется offset.
3. Получается итоговый глобальный scan по всему массиву.


## Проверка корректности
После выполнения GPU-версии:
1. Результат `out` копируется на CPU.
2. Сравнивается поэлементно с CPU-версией.
3. Если все элементы совпали — выводится `Check (CPU vs GPU) = OK`.

Также выводится последний элемент:
- `Last element CPU`
- `Last element GPU`

Для входа из единиц последний элемент должен быть равен 1000000.

